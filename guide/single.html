<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>Facebook SDK Grails Plugin 0.2.0</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
    </head>

    <body class="body" onload="addJsClass();">
        <div id="navigation">
            <ul>
                <li>
                    <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                        <a href="../guide/index.html" class="button">Table of contents</a>
                        <div id="nav-summary-childs" style="display:none;">
                            
                            <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#gettingStarted"><strong>2</strong><span>Getting started</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#facebookFilter"><strong>3</strong><span>Facebook Filter</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#facebookAppService"><strong>4</strong><span>Facebook App Service</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#facebookGraphClient"><strong>5</strong><span>Facebook Graph Client</span></a></div>
                            
                        </div>
                    </div>
                </li>
                <li class="separator selected">
                    <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
                </li>
            </ul>
        </div>
        <div id="header">
            <div class="images clearfix">
                
                
            </div>
            <p>The Facebook SDK Plugin allows your Grails application to use the Facebook Platform and develop Facebook apps on Facebook.com or on web sites (with Facebook Connect).
It is a port of the official Facebook PHP SDK V3.1.1 to Grails 2.0.
</p>
        </div>


        <table id="colset" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td id="col1">
                    <div id="main" class="corner-all">

                        <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                        <div class="project">
                            <h1>Facebook SDK Grails Plugin - Reference Documentation</h1>
                            <p><strong>Authors:</strong> Benoit Hediard</p>
                            <p><strong>Version:</strong> 0.2.0</p>
                            
                        </div>

                        
                        <div id="table-of-content">
                            <h2>Table of Contents</h2>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>2</strong><span>Getting started</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#facebookFilter"><strong>3</strong><span>Facebook Filter</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#facebookAppService"><strong>4</strong><span>Facebook App Service</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#facebookGraphClient"><strong>5</strong><span>Facebook Graph Client</span></a></div>
                            
                            <div style="clear:both" ></div>
                        </div>
                        
                        

<h1 id="introduction">1 Introduction</h1>
The <a href="http://developers.facebook.com/" target="blank">Facebook Platform</a> is a set of APIs that make your application more social. Read more about <a href="http://developers.facebook.com/docs/guides/web" target="blank">integrating Facebook with your web site</a> on the Facebook developer site.<p class="paragraph"/>This project contains the open source <strong class="bold">Facebook SDK Grails Plugin</strong> that allows you to integrate the <a href="http://developers.facebook.com/" target="blank">Facebook Platform</a> on a website/app powered by <a href="http://grails.org" target="blank">Grails</a> .<p class="paragraph"/>This plugin is a port of the official <a href="http://github.com/facebook/facebook-php-sdk" target="blank">Facebook PHP SDK V3.1.1</a> to <a href="http://grails.org" target="blank">Grails 2.0</a> .<p class="paragraph"/>It supports the latest <strong class="bold">OAuth2.0 authentication</strong> (required since October 1st 2011).<p class="paragraph"/><strong class="bold">Facebook SDK Grails Plugin</strong> provides :
<ul class="star">
<li><strong class="bold">FacebookAppService</strong> - A service to build <a href="http://developers.facebook.com/docs/guides/canvas/" target="blank">apps on Facebook.com</a> and <a href="http://developers.facebook.com/docs/guides/web" target="blank">websites with the Facebook Platform</a> .</li>
<li><strong class="bold">FacebookGraphClient</strong> - A client to call <a href="http://developers.facebook.com/docs/reference/api/," target="blank">Facebook Graph API</a> which is a wrapper around the rock solid <a href="http://restfb.com/" target="blank">RestFB java library</a> version 1.6.9 (released October 21, 2011).</li>
<li><strong class="bold">FacebookJSTagLib</strong> - A collection of tags to easily integrate <a href="http://developers.facebook.com/docs/reference/javascript/" target="blank">Facebook JS SDK</a> in your GSPs.</li>
</ul><p class="paragraph"/><h3>Bugs</h3><p class="paragraph"/>To report any bug, please use the project <a href="http://github.com/benorama/facebook-sdk-grails-plugin/issues" target="blank">Issues</a> section on GitHub.<p class="paragraph"/><blockquote class="note">
This is an <strong class="bold">alpha release</strong>.
The underlying APIs are generally stable, however we may make changes to the library in response to developer feedback.
</blockquote><p class="paragraph"/>
<h3>About</h3><p class="paragraph"/>The <strong class="bold">Facebook SDK Grails Plugin</strong> is not an official Facebook SDK such as <a href="http://developers.facebook.com/docs/reference/javascript/," target="blank">Javascript</a> <a href="http://github.com/facebook/facebook-php-sdk," target="blank">PHP</a> <a href="http://github.com/facebook/facebook-ios-sdk/" target="blank">iOS</a> and <a href="http://github.com/facebook/facebook-android-sdk." target="blank">Android SDKs</a><p class="paragraph"/>It is developped by <a href="http://www.agorapulse.com" target="blank">AgoraPulse</a> and licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html" target="blank">Apache Licence, Version 2.0</a> .


<h1 id="gettingStarted">2 Getting started</h1>
<h3>Installation</h3><p class="paragraph"/>Declare the plugin dependency in <code>BuildConfig.groovvy</code> file, as shown here:<p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolution = &#123;
		inherits(<span class="java&#45;quote">"global"</span>) &#123; &#125;
		log <span class="java&#45;quote">"info"</span>
		repositories &#123;
				//your repositories
		&#125;
		dependencies &#123;
				//your regular dependencies
		&#125;
		plugins &#123;
				//here go your plugin dependencies
				runtime ':facebook&#45;sdk:0.3.0'
		&#125;
&#125;</pre></div><p class="paragraph"/>
<h3>Config</h3><p class="paragraph"/>Create a Facebook app on <a href="https://developers.facebook.com/apps," target="blank">Facebook Developers</a> in order to get your own app ID and app secret.<p class="paragraph"/>Add your Facebook app parameters your <code>Config.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails.plugins.facebooksdk.appId = &#123;APP_ID&#125;
grails.plugins.facebooksdk.appPermissions = &#123;APP_PERMISSIONS&#125;
grails.plugins.facebooksdk.appSecret = &#123;APP_SECRET&#125;</pre></div><p class="paragraph"/>
<h3>Demo app</h3><p class="paragraph"/>If you want to quickly run the SDK on a demo app, you can download <a href="https://github.com/benorama/facebook-sdk-grails-demo." target="blank">Facebook SDK Grails - Demo</a><p class="paragraph"/>
<h3>Integration with Shiro Grails Plugin</h3><p class="paragraph"/>To see an example of integration with Shiro Grails Plugin, you can download <a href="https://github.com/benorama/facebook-sdk-grails-demo-shiro." target="blank">Facebook SDK Grails - Shiro demo</a><p class="paragraph"/>


<h1 id="facebookFilter">3 Facebook Filter</h1>
The plugin automatically run a filter that create the following data in request scope.<p class="paragraph"/><div class="code"><pre>request.facebook.app.id = &#123;APP_ID&#125;
request.facebook.app.permissions = &#123;APP_PERMISSIONS&#125;
request.facebook.app.secret = &#123;APP_SECRET&#125;
request.facebook.user.id = &#123;AUTHENTICATED_USER_ID&#125;
request.facebook.authenticated = &#123;TRUE_OR_FALSE&#125;</pre></div>


<h1 id="facebookAppService">4 Facebook App Service</h1>
Reference <code>facebookAppService</code> from any of your grails artefacts (controllers, domain, services...) to automatically inject it.<p class="paragraph"/><div class="code"><pre>def facebookAppService</pre></div><p class="paragraph"/>
<h3>User Id</h3><p class="paragraph"/>You can check if current user has authorized your app and is authenticated by getting <code>userId</code> from <code>facebookAppService</code>.
It will return <code>0</code> if user is not authenticated (or if he has not authorized your app).<p class="paragraph"/><div class="code"><pre>def userId = facebookAppService.getUserId()
<span class="java&#45;keyword">if</span> (userId) &#123;
	println <span class="java&#45;quote">"User authenticated (id=$&#123;userId&#125;)"</span>
&#125; <span class="java&#45;keyword">else</span> &#123;
	println <span class="java&#45;quote">"User not authenticated"</span>
&#125;</pre></div><p class="paragraph"/><h3>User Access Token</h3><p class="paragraph"/>If current user is authenticated, you can get his private <code>accessToken</code> from <code>facebookAppService</code>.<p class="paragraph"/>If the app is running on a website, the access token will be automatically fetched in exchange for the authorization code returned by <a href="http://developers.facebook.com/docs/reference/javascript/" target="blank">Facebook JS SDK</a> signed request cookie. It is recommended to wrap this code in a try/catch block since external HTTP calls to  <em class="italic">Facebook Graph API</em>  might be executed.<p class="paragraph"/>If the app is running on Facebook.com, the access token will be extracted from the signed request params (passed through the canvas iFrame).<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">try</span> &#123;
	<span class="java&#45;object">String</span> userAccessToken = facebookAppService.getUserAccessToken()
&#125; <span class="java&#45;keyword">catch</span> (Exception exception) &#123;
	// Something went wrong&#8230;
&#125;</pre></div><p class="paragraph"/>By default, after initial request, access token is stored in session scope for better performance: another reason to surround all your  <em class="italic">Facebook Graph API</em>  calls in try/catch in order to catch expired/invalid access tokens.<p class="paragraph"/>


<h1 id="facebookGraphClient">5 Facebook Graph Client</h1>
To perform Facebook Graph API call, use the <code>FacebookGraphClient</code> without access token for public data or with an access token for private data.
<code>FacebookGraphClient</code> is a thin groovy wrapper around the rock solid <a href="http://restfb.com/" target="blank">RestFB java library</a> .
It will return JSON-based graph objects.<p class="paragraph"/>To play with the API, you might use the grails console from your project root and get user token or app token from <a href="https://developers.facebook.com/tools/access_token/" target="blank">Facebook Access Token Tool</a> .<p class="paragraph"/><div class="code"><pre>grails console</pre></div><p class="paragraph"/><h3>Initialization</h3><p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.plugins.facebooksdk.FacebookGraphClient
// For <span class="java&#45;keyword">public</span> data
def facebookClient = <span class="java&#45;keyword">new</span> FacebookGraphClient()
// For <span class="java&#45;keyword">private</span> data (access token required)
def userAccessToken = facebookAppService.getUserAccessToken() // Or any app/user token
def facebookClient = <span class="java&#45;keyword">new</span> FacebookGraphClient(userAccessToken)</pre></div><p class="paragraph"/><h3>Fetching Single Objects</h3><p class="paragraph"/><div class="code"><pre>def user = facebookClient.fetchObject(<span class="java&#45;quote">"me"</span>) // Requires a user access token
def page = facebookClient.fetchObject(<span class="java&#45;quote">"cocacola"</span>)
println <span class="java&#45;quote">"User name: "</span> + user.name
println <span class="java&#45;quote">"Page likes: "</span> + page.likes</pre></div><p class="paragraph"/><h3>Fetching Multiple Objects in One Call</h3><p class="paragraph"/><div class="code"><pre>def fetchObjectsResults = facebookClient.fetchObjects(&#91;<span class="java&#45;quote">"me"</span>, <span class="java&#45;quote">"cocacola"</span>&#93;)
println <span class="java&#45;quote">"User name: "</span> + fetchObjectsResults&#91;<span class="java&#45;quote">"me"</span>&#93;.name
println <span class="java&#45;quote">"Page likes: "</span> + fetchObjectsResults&#91;<span class="java&#45;quote">"cocacola"</span>&#93;.likes</pre></div><p class="paragraph"/><h3>Fetching Connections</h3><p class="paragraph"/><div class="code"><pre>def myFriends = facebookClient.fetchConnection(<span class="java&#45;quote">"me/friends"</span>)
def myFeed = facebookClient.fetchConnection(<span class="java&#45;quote">"me/feed"</span>)
println <span class="java&#45;quote">"Count of my friends: "</span> + myFriends.size()
println <span class="java&#45;quote">"First item in my feed: "</span> + myFeed&#91;0&#93;</pre></div><p class="paragraph"/><h3>Searching</h3><p class="paragraph"/><div class="code"><pre>// Searching is just a special <span class="java&#45;keyword">case</span> of fetching Connections &#45;
// all you have to <span class="java&#45;keyword">do</span> is pass along a few extra parameters.
def publicSearch = facebookClient.fetchConnection(<span class="java&#45;quote">"search"</span>, &#91;q:<span class="java&#45;quote">"watermelon"</span>, type:<span class="java&#45;quote">"post"</span>&#93;)
println <span class="java&#45;quote">"Public search: "</span> + publicSearch&#91;0&#93;.message
// Targeted search
def targetedSearch = facebookClient.fetchConnection(<span class="java&#45;quote">"me/home"</span>, &#91;q:<span class="java&#45;quote">"Mark"</span>, type:<span class="java&#45;quote">"user"</span>&#93;)
println <span class="java&#45;quote">"Posts on my wall by friends named Mark: "</span> + targetedSearch.size()</pre></div><p class="paragraph"/><h3>Fetching Insights</h3><p class="paragraph"/><div class="code"><pre>// Fetching Insights data is as simple as fetching a Connection
def insights = facebookClient.fetchConnection(<span class="java&#45;quote">"PAGE_ID/insights"</span>)
<span class="java&#45;keyword">for</span> (insight in insights) println insight.name</pre></div><p class="paragraph"/><h3>Executing FQL Queries</h3><p class="paragraph"/><div class="code"><pre><span class="java&#45;object">String</span> query = <span class="java&#45;quote">"SELECT uid, name FROM user WHERE uid=220439 or uid=7901103"</span>
def users = facebookClient.executeQuery(query)
println <span class="java&#45;quote">"Users: "</span> + users</pre></div><p class="paragraph"/><h3>Executing Multiple FQL Queries in One Call</h3><p class="paragraph"/><div class="code"><pre>Map queries = &#91;users:<span class="java&#45;quote">"SELECT uid, name FROM user WHERE uid=220439 OR uid=7901103"</span>, likers:<span class="java&#45;quote">"SELECT user_id FROM like WHERE object_id=122788341354"</span>&#93;
multiqueryResults = facebookClient.executeMultiquery(queries)
println <span class="java&#45;quote">"Users: "</span> + multiqueryResults.users
println <span class="java&#45;quote">"People who liked: "</span> + multiqueryResults.likers</pre></div><p class="paragraph"/><h3>Metadata/Introspection</h3><p class="paragraph"/><div class="code"><pre>// You can specify metadata=1 <span class="java&#45;keyword">for</span> many calls, not just <span class="java&#45;keyword">this</span> one.
// See the Facebook Graph API documentation <span class="java&#45;keyword">for</span> more details.
def userWithMetadata = facebookClient.fetchObject(<span class="java&#45;quote">"me"</span>, &#91;metadata:1&#93;)
println <span class="java&#45;quote">"User connections  "</span> + userWithMetadata.metadata.connections</pre></div><p class="paragraph"/><h3>Passing Parameters</h3><p class="paragraph"/><div class="code"><pre>// You can pass along any parameters you'd like to the Facebook endpoint.
Date oneWeekAgo = <span class="java&#45;keyword">new</span> Date() &#45; 7
def filteredFeed = facebookClient.fetchConnection(<span class="java&#45;quote">"me/feed"</span>, &#91;limit:3, until:<span class="java&#45;quote">"yesterday"</span>, since:oneWeekAgo&#93;)
println <span class="java&#45;quote">"Filtered feed count: "</span> + filteredFeed.size()</pre></div><p class="paragraph"/><h3>Selecting Specific Fields</h3><p class="paragraph"/><div class="code"><pre>def user = facebookClient.fetchObject(<span class="java&#45;quote">"me"</span>, &#91;fields:<span class="java&#45;quote">"id, name"</span>&#93;)
println <span class="java&#45;quote">"User name: "</span> + user.name</pre></div><p class="paragraph"/><h3>Publishing a Message and Event</h3><p class="paragraph"/><div class="code"><pre>// Publishing a simple message.
def publishMessageResponse = facebookClient.publish(<span class="java&#45;quote">"me/feed"</span>, &#91;message:<span class="java&#45;quote">"RestFB test"</span>&#93;)
println <span class="java&#45;quote">"Published message ID: "</span> + publishMessageResponse.id<p class="paragraph"/>// Publishing an event
Date tomorrow = <span class="java&#45;keyword">new</span> Date() + 1
Date twoDaysFromNow = <span class="java&#45;keyword">new</span> Date() + 2
def publishEventResponse = facebookClient.publish(<span class="java&#45;quote">"me/events"</span>, &#91;name:<span class="java&#45;quote">"Party"</span>, start_time:tomorrow, end_time:twoDaysFromNow&#93;)
println <span class="java&#45;quote">"Published event ID: "</span> + publishEventResponse.id</pre></div><p class="paragraph"/><h3>Publishing a Photo or a Video</h3><p class="paragraph"/><div class="code"><pre>// Publishing an image to a photo album is easy!
// Just specify the image you'd like to upload and RestFB will handle it from there.
def publishPhotoResponse = facebookClient.publishFile(<span class="java&#45;quote">"me/photos"</span>, &#91;message, <span class="java&#45;quote">"Test cat"</span>&#93;, <span class="java&#45;quote">"/cat.png"</span>)
println <span class="java&#45;quote">"Published photo ID: "</span> + publishPhotoResponse.id
// Publishing a video works the same way.
facebookClient.publish(<span class="java&#45;quote">"me/videos"</span>, &#91;message, <span class="java&#45;quote">"Test cat"</span>&#93;, <span class="java&#45;quote">"/cat.mov"</span>)</pre></div><p class="paragraph"/><h3>Deleting</h3><p class="paragraph"/><div class="code"><pre><span class="java&#45;object">Boolean</span> deleted = facebookClient.deleteObject(<span class="java&#45;quote">"some object ID"</span>)
out.println(<span class="java&#45;quote">"Deleted object? "</span> + deleted)</pre></div><p class="paragraph"/><h3>Using the Batch Request API</h3><p class="paragraph"/><div class="code"><pre>List batchResponses = facebookClient.executeBatch(&#91;<span class="java&#45;quote">"me"</span>, <span class="java&#45;quote">"m83music/feed"</span>&#93;);
// Responses are ordered to match up with their corresponding requests.
println <span class="java&#45;quote">"Me object "</span> + batchResponses&#91;0&#93;
println <span class="java&#45;quote">"M83 feed "</span> + batchResponses&#91;1&#93;</pre></div><p class="paragraph"/><h3>Error Handling</h3><p class="paragraph"/>All <code>FacebookClient</code> methods may throw <code>com.restfb.exception.FacebookException</code>, which is an unchecked exception as of RestFB 1.6.<p class="paragraph"/>These are the <code>FacebookException</code> subclasses that you may catch:
<ul class="star">
<li><code>FacebookJsonMappingException</code></li>
<li><code>FacebookNetworkException</code></li>
<li><code>FacebookGraphException</code></li>
<li><code>FacebookOAuthException</code></li>
<li><code>FacebookQueryParseException</code></li>
<li><code>FacebookResponseStatusException</code></li>
</ul><p class="paragraph"/>For more info, check <a href="http://restfb.com/" target="blank">RestFB java library</a> documentation.

                    </div>
                </td>
                <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">tags</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/tags/initJS.html">initJS</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/tags/loginLink.html">loginLink</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/tags/logoutLink.html">logoutLink</a>
                        </div>
                        
                        </div>
                    </div>
                    
                </div>
            </div>
        </td>
            </tr>
        </table>

        <div id="footer">
            
            
        </div>



<script type="text/javascript" src="../js/docs.js"></script>

    </body>
</html>
